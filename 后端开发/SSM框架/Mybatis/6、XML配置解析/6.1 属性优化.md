# 属性优化

## 一、 核心配置文件

核心配置文件为：**mybatis.config.xml**
Mybatis的配置文件包含了会深深影响Mybatis行为的设置和属性信息。

[**XML配置**](https://mybatis.org/mybatis-3/zh/configuration.html)**（官网帮助文档）**
 configuration（配置） 

- [properties（属性）](https://mybatis.org/mybatis-3/zh/configuration.html#properties)
- [settings（设置）](https://mybatis.org/mybatis-3/zh/configuration.html#settings)
- [typeAliases（类型别名）](https://mybatis.org/mybatis-3/zh/configuration.html#typeAliases)
- [typeHandlers（类型处理器）](https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers)
- [objectFactory（对象工厂）](https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory)
- [plugins（插件）](https://mybatis.org/mybatis-3/zh/configuration.html#plugins)
- [environments（环境配置）](https://mybatis.org/mybatis-3/zh/configuration.html#environments)
   -  environment（环境变量） 
      - transactionManager（事务管理器）
      - dataSource（数据源）
- [databaseIdProvider（数据库厂商标识）](https://mybatis.org/mybatis-3/zh/configuration.html#databaseIdProvider)
- [mappers（映射器）](https://mybatis.org/mybatis-3/zh/configuration.html#mappers)

## 二、 环境配置（environments）

**MyBatis 可以配置成适应多种环境**

- [x] 理解：

在`environments`标签中可以配置多个`environment`环境，但是默认是**environments default=**后的id。
若想更换默认环境，则修改**default**的id值即可。
```xml
<!--configuration核心配置文件-->
<configuration>
  <!--default默认的id就是默认的配置-->
    <environments default="development-01">
        <environment id="development-01">
           <!--这里是环境development-01-->
        </environment>
      <environment id="development-02">
           <!--这里是环境development-02-->
        </environment>
    </environments>
```
**不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。**

### 2.1 事务管理器（transactionManager）

了解即可
在 MyBatis 中有两种类型的事务管理器（也就是 type="[JDBC|MANAGED]"）：

-  **JDBC** – 这个配置直接使用了 JDBC 的提交和回滚设施，它依赖从数据源获得的连接来管理事务作用域。 
-  **MANAGED** – 这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接。然而一些容器并不希望连接被关闭，因此需要将 closeConnection 属性设置为 false 来阻止默认的关闭行为。

### 2.2 数据源（dataSource）

了解即可
**池**：用完可以回收。
dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。
大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。 

有三种内建的数据源类型（也就是 type="[UNPOOLED|POOLED|JNDI]"）：
**UNPOOLED **– 这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。
**POOLED**** **– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。  
**JNDI** – 这个数据源实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的数据源引用。  

---

**重点**
**Mybatis默认的事物管理器就是JDBC，连接池就是POOLED。**

## 三、 属性（properties）

我们可以通过properties属性来实现引用配置文件。

这些属性可以在外部进行配置，并可以进行动态替换。你既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。  

编写一个配置文件
db.properties
```properties
driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/mybatis?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF8
username=root
password=123456
```

在**核心配置文件**mybatis-config.xml中引入**properties**
注意：在xml中，所有的标签都可以规定其顺序，**properties**只能放在最上面
```xml
<!--引入外部配置文件-->
    <properties resource="db.properties">
        <property name="username" value="root"/>
        <property name="password" value="123456"/>
    </properties>
```
注意：可以直接引入外部文件，也可以在其中增加一些属性配置，如果两个文件有同一字段，**优先使用外部配置文件！**
**优先使用外部配置文件**理解：当配置文件**db.properties**中写了username和password，**核心配置文件**mybatis-config.xml中的`properties`标签中也写了username和password，则优先使用**db.propertise**文件中的配置信息。

