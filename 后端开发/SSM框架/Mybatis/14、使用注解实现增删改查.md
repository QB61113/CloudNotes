# 使用注解实现增删改查

## 一、注解实现增删改查

我们可以在工具类创建的时候实现自动提交事务。

==注意：==需要优化工具类` return sqlSessionFactory.openSession(true);`，设置**自动提交事务**。

```java
//工具类
//sqlSessionFactory  工厂模式
public class MybatisUtils {

    private static SqlSessionFactory sqlSessionFactory;
    static {
        try {
            //使用Mybatis第一步，必须要做！！！
            //获取SqlSessionFactory对象
            String resource = "mybatis-config.xml";
            InputStream inputStream = Resources.getResourceAsStream(resource);
            sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    
    public static SqlSession getSqlSession() {
        //openSession方法的自动提交设置为true就会自动提交了
        return sqlSessionFactory.openSession(true);
    }
}
```



**编写接口，增加注解**

```java
public interface UserMapper {

    @Select("select * from user")
    List<User> getUsers();

    //方法存在多个参数，所有的参数前面必须加上@Param("")注解
    @Select("select * from user where id = #{id}")
    User getUserById(@Param("id") int id);

    //引用对象不需要写@Param("")
    @Insert("insert into user(id,name,pwd) values(#{id},#{name},#{password})")
    int addUser(User user);

    @Update("update user set name=#{name},pwd=#{password} where id=#{id}")
    int updateUser(User user);

    @Delete("delete from user where id=#{id}")
    int deleteUser(@Param("id") int id);
}
```



**测试类**

```java
public class UserMapperTest {

   //注解实现查询
   @Test
    public void select(){

       SqlSession sqlSession = MybatisUtils.getSqlSession();

       //底层主要应用反射
       UserMapper mapper = sqlSession.getMapper(UserMapper.class);

       User userById =  mapper.getUserById(1);
       System.out.println(userById);

       sqlSession.close();

   }

   //注解实现添加
   @Test
   public void add(){

      SqlSession sqlSession = MybatisUtils.getSqlSession();

      //底层主要应用反射
      UserMapper mapper = sqlSession.getMapper(UserMapper.class);

      mapper.addUser(new User(7,"hello","123456"));


      sqlSession.close();

   }

   //注解实现更新
   @Test
   public void update(){

      SqlSession sqlSession = MybatisUtils.getSqlSession();

      //底层主要应用反射
      UserMapper mapper = sqlSession.getMapper(UserMapper.class);

      mapper.updateUser(new User(6,"two","123456"));

      sqlSession.close();

   }

   //注解实现删除
   @Test
   public void delete(){

      SqlSession sqlSession = MybatisUtils.getSqlSession();

      //底层主要应用反射
      UserMapper mapper = sqlSession.getMapper(UserMapper.class);

      mapper.deleteUser(6);
      mapper.deleteUser(7);
      mapper.deleteUser(8);

      sqlSession.close();
   }
}
```

**==注意：==必须将接口注册到核心配置文件中！**（具体见前面映射器章节）



## 二、关于@Param()注解

- 基本类型的参数或者String类型，需要加上。
- 引用类型不需要加。
- 如果只有一个基本类型，可以会略，但是建议加上。
- 在SQL中引用的就是这里的`@Param("")`中设定的属性名。



## 三、#{} 和 ${}区别

#{}能够大程度上防止sql注入，用${}无法防止sql注入。

==**能用#{}时尽量用#{}**==。

